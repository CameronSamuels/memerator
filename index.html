
<!DOCTYPE html><html>
	<head>
		<title>Memerator</title>
		<meta name="description" content="Create memes for FREE!">
		<meta name="viewport" content="user-scalable=yes,initial-scale=1,width=deice-width">
		<style>
			form div {
				overflow: hidden;
				position: relative;
			}

			form div [type=file] {
				cursor: inherit;
				display: block;
				filter: alpha(opacity=0);
				opacity: 0;
				height: 50px;
				position: absolute;
				top: 0;
			}
			
			form div {
				background: gray;
				border-radius: 6px;
				left: 0;
				right: 0;
				margin: auto;
				max-width: 20%;
				height: 50px;
				overflow: hidden;
				position: relative;
				line-height: 50px;
				vertical-align: middle;
			}

			form div [type=file] {
				cursor: pointer;
			}
			canvas {
				width: 100%;
				max-width: 40vh;
				margin: auto;
				margin-top: 50px;
				padding: 0;
				display: block;
			}
		</style>
	</head>
	<body>
		<canvas id="myCanvas"></canvas>
		<form>
			<div id="upload">Upload image<input type="file" /></div>
			<label>Top text:</label>
			<input type="text" />
			<p></p>
			<label>Bottom text:</label>
			<input type="text" />
		</form>
		<script>
			var $ = function(i){return document.querySelector(i)}, img, canvas = document.querySelector('canvas');
			canvas.width = 1024, canvas.height = 1024;
			$('[type=file]').addEventListener("change", function(event) {
				var canvas = $('canvas'), url = this.value, ext = url.substring(url.lastIndexOf('.') + 1).toLowerCase();
				if ($('input').files && $('input').files[0] && (ext == "gif" || ext == "png" || ext == "jpeg" || ext == "jpg")) {
					var reader = new FileReader();
					reader.onload = function(e) {
						//           document.querySelector('img').setAttribute('src', e.target.result);
						var canvas = $("canvas"), ctx = canvas.getContext("2d");
						img = new Image();
						img.onload = function() {
							var oc = document.createElement('canvas'),
							octx = oc.getContext('2d');
							oc.width = img.width;
							oc.height = img.height;
							octx.drawImage(img, 0, 0, oc.width, oc.height);
							octx.drawImage(oc, 0, 0, oc.width, oc.height);
							ctx.drawImage(oc, 0, 0, oc.width, oc.height, 0, 0, canvas.width, canvas.height);
						}
						img.src = e.target.result;
					}
					reader.readAsDataURL($('[type=file]').files[0]);
				} else {
					//$('#img').attr('src', '/assets/no_preview.png');
				}
			}, false);

			function text(event) {
				var canvas = $('canvas'), ctx = canvas.getContext("2d");
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				if ("createEvent" in document) {
					var evt = document.createEvent("HTMLEvents");
					evt.initEvent("change", false, true);
					$('[type=file]').dispatchEvent(evt);
				} else $('[type=file]').fireEvent("onchange");
				setTimeout(function() {
					ctx.font = "100px Arial";
					ctx.fillText(document.querySelectorAll('input')[1].value, 10, 200);
					ctx.fillText(document.querySelectorAll('input')[2].value, 10, 850);
				}, 1000);
			}
			document.querySelectorAll('[type=text]')[0].addEventListener("keyup", text, false);
			document.querySelectorAll('[type=text]')[1].addEventListener("keyup", text, false);
</script>
